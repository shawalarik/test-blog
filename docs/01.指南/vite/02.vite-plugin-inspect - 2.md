---
date: 2025-06-18 08:36:31
title: Vite Plugin Inspect 插件 - 2
permalink: /vite/vite-plugin-inspect-2
categories:
  - 指南
coverImg: /home/bg23.webp
---



### 如何查看 `__inspect` 内容并进行性能优化

`vite-plugin-inspect` 提供的 `__inspect` 界面是一个强大的调试工具，可帮助你分析 Vite 构建过程并找出优化点。以下是详细的使用指南：

### **1. 访问检查界面**

启动开发服务器时添加 `--inspect` 参数：



```bash
# 对于 VitePress 项目
npm run docs:dev -- --inspect

# 对于普通 Vite 项目
vite dev --inspect
```



启动后，访问：

```plaintext
http://localhost:5173/__inspect
```

### **2. 界面核心功能与分析方法**

#### **插件列表（Plugins）**

展示所有 Vite 插件的执行顺序和配置：

- **分析重点**：
  - 检查插件执行顺序是否符合预期
  - 查看插件配置参数是否正确
  - 识别可能导致冲突的插件
- **优化示例**：

```js
// 调整插件顺序，确保某些插件优先执行
plugins: [
  // 前置处理插件
  myPreprocessorPlugin(),
  
  // 核心构建插件
  vue(),
  
  // 后置处理插件
  inspect()
]
```



#### **模块分析（Modules）**

展示模块解析路径和依赖关系：

- **分析重点**：

  - 查找重复引入的模块
  - 检查模块解析路径是否正确
  - 识别大体积模块或不必要的依赖

- **优化示例**：

```js
resolve: {
  dedupe: ['react', 'vue'] // 强制 deduplicate 关键依赖
}
```

#### **转换过程（Transforms）**

展示代码从源码到最终产物的转换过程：

- **分析重点**：
  - 查看每个插件对代码的转换结果
  - 检查是否存在不必要的转换或过度处理
  - 识别可能导致性能问题的转换步骤
  
- **优化示例**：

```js
// 排除不需要处理的文件
myPlugin({
  exclude: [/node_modules/, /\.svg$/],
})
```



#### **构建性能（Performance）**

展示构建过程中各阶段的耗时：

- **分析重点**：
  - 找出最耗时的插件或处理步骤
  - 检查冷启动和热更新时间
  - 识别可能的性能瓶颈
- **优化示例**：

```js
// 缓存耗时操作
esbuild({
  cache: true // 启用 esbuild 缓存
})
```

### **3. 常见优化场景与解决方案**

#### **场景 1：构建时间过长**

- 优化方法
  - 禁用不必要的插件
  - 配置缓存策略（如 `vite-plugin-esbuild` 的 `cache` 选项）
  - 使用 `vite-plugin-optimizer` 预构建大型依赖

#### **场景 2：模块重复引入**

- 优化方法
  - 使用 `resolve.dedupe` 强制 deduplicate 依赖
  - 检查依赖版本冲突（使用 `npm ls` 或 `pnpm why`）
  - 配置 `optimizeDeps` 预构建关键依赖

#### **场景 3：热更新缓慢**

- 优化方法
  - 减少需要 HMR 的模块数量
  - 使用 `vite-plugin-react-refresh` 等优化 HMR 的插件
  - 配置 `server.watch.ignored` 忽略不必要的文件变化

#### **场景 4：包体积过大**

- 优化方法
  - 使用 Tree Shaking 排除未使用的代码
  - 分析包内容（结合 `vite-plugin-bundle-visualizer`）
  - 按需加载大体积模块（如动态导入）

### **4. 结合其他工具进行深度优化**

#### **1. 使用 Bundle Visualizer 分析包体积**

```bash
npm install -D vite-plugin-bundle-visualizer
```

```javascript
// vite.config.js
import { visualizer } from 'vite-plugin-bundle-visualizer'

export default {
  plugins: [
    visualizer({
      open: true // 构建后自动打开分析页面
    })
  ]
}
```

#### **2. 使用 Speed Measure Plugin 测量插件性能**

```bash
npm install -D vite-plugin-speed-measure
```

```javascript
// vite.config.js
import { defineConfig } from 'vite'
import Inspect from 'vite-plugin-inspect'
import { wrapPlugin } from 'vite-plugin-speed-measure'

export default defineConfig({
  plugins: [
    wrapPlugin(Inspect()),
    // 其他插件...
  ]
})
```

#### **3. 使用 Vite 内置优化配置**

```javascript
// vite.config.js
export default {
  // 预构建依赖
  optimizeDeps: {
    include: ['react', 'react-dom']
  },
  
  // 构建优化
  build: {
    minify: 'terser', // 更强大的压缩器
    chunkSizeWarningLimit: 1000, // 调整警告阈值
    rollupOptions: {
      output: {
        manualChunks(id) {
          // 手动分割大模块
          if (id.includes('node_modules')) {
            return 'vendor';
          }
        }
      }
    }
  }
}
```

### **5. 性能优化最佳实践**

1. **开发环境优化**：
   - 禁用不必要的插件（如压缩插件）
   - 使用内存文件系统（`server.fs` 配置）
   - 减少 HMR 范围
2. **生产环境优化**：
   - 启用代码分割和懒加载
   - 使用 CDN 加载外部资源
   - 配置 `build.assetsInlineLimit` 控制资源内联阈值
3. **持续监控**：
   - 定期分析构建性能和包体积
   - 使用 GitHub Actions 等工具自动化性能监控
   - 建立性能基线，确保优化效果持续存在

通过 `__inspect` 界面和上述优化方法，你可以深入了解 Vite 构建过程，找出性能瓶颈，并针对性地优化项目配置，提升开发体验和生产环境性能。
